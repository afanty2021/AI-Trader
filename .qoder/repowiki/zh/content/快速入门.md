# 快速入门

<cite>
**本文档中引用的文件**  
- [README.md](file://README.md)
- [requirements.txt](file://requirements.txt)
- [main.py](file://main.py)
- [agent_tools/start_mcp_services.py](file://agent_tools/start_mcp_services.py)
- [data/get_daily_price.py](file://data/get_daily_price.py)
- [data/A_stock/get_daily_price_a_stock.py](file://data/A_stock/get_daily_price_a_stock.py)
- [data/merge_jsonl.py](file://data/merge_jsonl.py)
- [data/A_stock/merge_a_stock_jsonl.py](file://data/A_stock/merge_a_stock_jsonl.py)
- [scripts/main.sh](file://scripts/main.sh)
- [scripts/main_a_stock_step1.sh](file://scripts/main_a_stock_step1.sh)
- [scripts/main_a_stock_step2.sh](file://scripts/main_a_stock_step2.sh)
- [scripts/main_a_stock_step3.sh](file://scripts/main_a_stock_step3.sh)
- [configs/default_config.json](file://configs/default_config.json)
- [configs/astock_config.json](file://configs/astock_config.json)
</cite>

## 目录
1. [简介](#简介)
2. [项目结构概览](#项目结构概览)
3. [克隆仓库](#克隆仓库)
4. [安装依赖](#安装依赖)
5. [配置环境变量](#配置环境变量)
6. [准备数据](#准备数据)
7. [启动MCP服务](#启动mcp服务)
8. [运行交易代理](#运行交易代理)
9. [美股与A股启动脚本使用示例](#美股与a股启动脚本使用示例)
10. [故障排除](#故障排除)

## 简介
本指南旨在为新手用户提供一个从零开始运行AI-Trader项目的完整分步说明。AI-Trader是一个让多个AI模型在美股（NASDAQ 100）和A股（SSE 50）市场中自主竞争的平台。本指南将详细介绍如何克隆仓库、安装依赖、配置环境、准备数据、启动服务并运行交易代理，确保用户能够快速上手并成功运行项目。

## 项目结构概览
在开始之前，了解项目的基本结构有助于理解各个组件的作用。项目主要分为以下几个核心目录：
- `agent/`: 包含AI交易代理的核心逻辑，分为美股和A股专用代理。
- `agent_tools/`: MCP工具链，提供交易、价格查询、搜索等核心功能。
- `configs/`: 配置文件，定义了代理类型、市场、日期范围和AI模型等。
- `data/`: 数据处理脚本和原始数据，包括美股和A股的价格获取与格式转换。
- `scripts/`: 一键式启动脚本，简化了复杂的启动流程。
- `prompts/`: 为AI代理提供的系统提示词，指导其决策逻辑。

**Section sources**
- [README.md](file://README.md#L1-L793)

## 克隆仓库
首先，您需要将项目代码从GitHub仓库克隆到本地。

```bash
git clone https://github.com/HKUDS/AI-Trader.git
cd AI-Trader
```

此步骤将创建一个名为`AI-Trader`的本地目录，并将所有项目文件下载到该目录中。这是所有后续操作的基础。

**Section sources**
- [README.md](file://README.md#L1-L793)

## 安装依赖
项目依赖于一系列Python库，这些库列在`requirements.txt`文件中。使用`pip`命令安装这些依赖。

```bash
pip install -r requirements.txt
```

该命令会读取`requirements.txt`文件并自动安装所有必需的包，包括`langchain`、`fastmcp`、`tushare`等。确保您的Python环境版本为3.10或更高。

**Section sources**
- [requirements.txt](file://requirements.txt#L1-L7)
- [README.md](file://README.md#L1-L793)

## 配置环境变量
项目通过`.env`文件来管理敏感信息和配置，如API密钥。您需要创建一个`.env`文件并填入相应的值。

1. 复制示例文件：
```bash
cp .env.example .env
```

2. 编辑`.env`文件，填入您的API密钥：
```bash
OPENAI_API_BASE=https://your-openai-proxy.com/v1
OPENAI_API_KEY=your_openai_key
ALPHAADVANTAGE_API_KEY=your_alpha_vantage_key
JINA_API_KEY=your_jina_api_key
TUSHARE_TOKEN=your_tushare_token
RUNTIME_ENV_PATH=./runtime_env.json
MATH_HTTP_PORT=8000
SEARCH_HTTP_PORT=8001
TRADE_HTTP_PORT=8002
GETPRICE_HTTP_PORT=8003
AGENT_MAX_STEP=30
```

这些变量分别用于连接OpenAI、Alpha Vantage（美股数据）、Jina（信息搜索）和Tushare（A股数据）的API。缺少任何一项都可能导致数据获取或AI推理失败。

**Section sources**
- [README.md](file://README.md#L1-L793)

## 准备数据
在运行交易代理之前，必须先获取并准备股票价格数据。项目为美股和A股提供了独立的数据获取和格式化脚本。

### 准备美股数据
```bash
cd data
python get_daily_price.py
python merge_jsonl.py
cd ..
```
- `get_daily_price.py` 从Alpha Vantage API获取NASDAQ 100成分股的每日价格数据。
- `merge_jsonl.py` 将分散的JSON文件合并为统一的`merged.jsonl`格式，供交易代理使用。

### 准备A股数据
```bash
cd data/A_stock
python get_daily_price_a_stock.py
python merge_a_stock_jsonl.py
cd ..
```
- `get_daily_price_a_stock.py` 使用Tushare API获取上证50（SSE 50）成分股的每日价格数据。
- `merge_a_stock_jsonl.py` 将CSV格式的数据转换为交易代理所需的`merged.jsonl`格式。

**Section sources**
- [data/get_daily_price.py](file://data/get_daily_price.py#L1-L139)
- [data/A_stock/get_daily_price_a_stock.py](file://data/A_stock/get_daily_price_a_stock.py#L1-L272)
- [data/merge_jsonl.py](file://data/merge_jsonl.py)
- [data/A_stock/merge_a_stock_jsonl.py](file://data/A_stock/merge_a_stock_jsonl.py)

## 启动MCP服务
MCP（Model Context Protocol）服务是AI代理与外部世界交互的桥梁，包括交易、价格查询和信息搜索等工具。在运行代理前，必须先启动这些服务。

```bash
cd agent_tools
python start_mcp_services.py
```

此脚本会启动四个独立的HTTP服务，分别监听在8000、8001、8002和8003端口，对应数学计算、信息搜索、交易执行和价格查询功能。这些服务必须在后台持续运行，直到交易代理完成。

**Section sources**
- [agent_tools/start_mcp_services.py](file://agent_tools/start_mcp_services.py)

## 运行交易代理
数据和服务准备就绪后，即可启动交易代理。代理会根据配置文件中的设定，模拟在指定日期范围内进行交易。

### 运行美股交易代理
```bash
python main.py configs/default_config.json
```

### 运行A股交易代理
```bash
python main.py configs/astock_config.json
```

`main.py`是项目的主程序入口。它会根据配置文件中的`agent_type`（如`BaseAgent`或`BaseAgentAStock`）动态加载相应的AI代理类，并初始化MCP连接。代理将基于历史数据进行推理，并执行买卖操作，所有交易记录将保存在`data/agent_data`或`data/agent_data_astock`目录中。

**Section sources**
- [main.py](file://main.py#L1-L282)
- [configs/default_config.json](file://configs/default_config.json#L1-L53)
- [configs/astock_config.json](file://configs/astock_config.json#L1-L63)

## 美股与A股启动脚本使用示例
为了简化复杂的启动流程，项目提供了多个一键式脚本，位于`scripts/`目录下。

### 美股一键启动
使用`main.sh`脚本可以自动完成从数据准备到启动代理的全过程。
```bash
bash scripts/main.sh
```
该脚本内部执行了以下步骤：
1. 运行`main_step1.sh`：获取并合并美股数据。
2. 运行`main_step2.sh`：启动MCP服务。
3. 运行`main_step3.sh`：使用`default_config.json`启动美股交易代理。

### A股分步启动
A股的启动需要分三步进行，以确保流程清晰。

**第一步：准备A股数据**
```bash
bash scripts/main_a_stock_step1.sh
```
此脚本进入`data/A_stock`目录并运行`get_daily_price_a_stock.py`和`merge_a_stock_jsonl.py`。

**第二步：启动MCP服务**
```bash
bash scripts/main_a_stock_step2.sh
```
此脚本与美股的MCP启动脚本功能相同。

**第三步：运行A股交易代理**
```bash
bash scripts/main_a_stock_step3.sh
```
此脚本使用`astock_config.json`配置文件启动`BaseAgentAStock`代理。

**Section sources**
- [scripts/main.sh](file://scripts/main.sh#L1-L39)
- [scripts/main_a_stock_step1.sh](file://scripts/main_a_stock_step1.sh#L1-L16)
- [scripts/main_a_stock_step2.sh](file://scripts/main_a_stock_step2.sh#L1-L13)
- [scripts/main_a_stock_step3.sh](file://scripts/main_a_stock_step3.sh#L1-L14)

## 故障排除
如果在运行过程中遇到问题，请参考以下常见解决方案：

- **API密钥错误**：确保`.env`文件中的所有API密钥正确无误，特别是`TUSHARE_TOKEN`和`ALPHAADVANTAGE_API_KEY`。
- **端口占用**：如果MCP服务无法启动，检查8000-8003端口是否已被其他程序占用，可通过`lsof -i :8002`等命令查看。
- **数据文件缺失**：运行`main.py`前，务必确认`data/merged.jsonl`或`data/A_stock/merged.jsonl`文件已成功生成。
- **Python依赖问题**：建议使用虚拟环境（如`venv`或`conda`）来隔离项目依赖，避免版本冲突。

**Section sources**
- [README.md](file://README.md#L1-L793)